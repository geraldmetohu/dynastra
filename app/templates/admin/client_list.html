{% extends "base.html" %}

{% block content %}
  {% include "components/admin_nav.html" %}
<head>
    <link rel="stylesheet" href="{{ url_for('static', path='/css/admin.css') }}">

</head>
  <div class="bg-gray-100A text-gray-800A p-8A min-h-screenA">
    <div class="max-w-7xlA mx-autoA bg-whiteA rounded-xlA shadow-mdA p-6A">
      <div class="flexA justify-betweenA items-centerA mb-6A">
        <h2 class="text-2xlA font-boldA">Client List</h2>
        <a href="/admin/client/new" class="bg-blue-600A text-whiteA px-4A py-2A roundedA hover-bg-blue-700A">+ Create Client</a>
      </div>

      <div class="overflow-x-autoA">
        <table class="min-w-fullA divide-yA divide-gray-200A text-smA">
          <thead class="bg-gray-100A text-gray-700A">
            <tr>
              <th class="px-4A py-2A text-leftA">#</th>
              <th class="px-4A py-2A text-leftA">Name</th>
              <th class="px-4A py-2A text-leftA">Email</th>
              <th class="px-4A py-2A text-leftA">Phone</th>
              <th class="px-4A py-2A text-leftA">Client Type</th>
              <th class="px-4A py-2A text-leftA">Task(s)</th>
              <th class="px-4A py-2A text-leftA">Status</th>
              <th class="px-4A py-2A text-leftA">Date Created</th>
              <th class="px-4A py-2A text-leftA">Actions</th>
            </tr>
          </thead>
          <tbody class="divide-yA divide-gray-200A">
            {% for client in clients %}
            <tr>
              <td class="px-4A py-2A">{{ loop.index }}</td>
              <td class="px-4A py-2A">{{ client.name }} {{ client.surname }}</td>
              <td class="px-4A py-2A">{{ client.email }}</td>
              <td class="px-4A py-2A">{{ client.phone }}</td>
              <td class="px-4A py-2A">{{ client.clientType }}</td>
              <td class="px-4A py-2A">
                {% for task in client.tasks or [] %}
                  <span class="inline-blockA bg-blue-100A text-blue-800A text-xsA px-2A py-1A roundedA mr-1A">{{ task }}</span>
                {% endfor %}
              </td>
              <td class="px-4A py-2A">
                <span class="inline-blockA px-2A py-1A text-xsA roundedA 
                  {% if client.status == 'Paid' %}bg-green-100A text-green-800A
                  {% elif client.status == 'Finished' %}bg-emerald-100A text-emerald-800A
                  {% elif client.status == 'Started' %}bg-blue-100A text-blue-800A
                  {% elif client.status == 'Agreed' %}bg-yellow-100A text-yellow-800A
                  {% else %}bg-gray-100A text-gray-700A{% endif %}">
                  {{ client.status or '—' }}
                </span>
              </td>
              <td class="px-4A py-2A">
                {% if client.createdAt %}{{ client.createdAt.strftime('%Y-%m-%d') }}{% else %}—{% endif %}
              </td>
              <td class="px-4A py-2A space-y-1A">
                <a href="/admin/client/edit/{{ client.id }}" class="text-indigo-600A hover-underlineA blockA">Edit</a>

                <!-- DELETE as POST + confirm -->
                <form method="post"
                      action="/admin/client/delete/{{ client.id }}"
                      onsubmit="return confirm('Delete {{ client.name }} {{ client.surname }}? This will also remove their invoices.');"
                      style="display:block;margin:0;padding:0;">
                  <button type="submit"
                          class="text-red-600A hover-underlineA blockA bg-transparent border-0 p-0 cursor-pointer">
                    Delete
                  </button>
                </form>

                <a href="/admin/invoice/create/{{ client.id }}" class="text-green-600A hover-underlineA blockA">Send Invoice</a>
                <a href="/admin/client/{{ client.id }}/invoices" class="text-purple-600A hover-underlineA blockA">View Invoices</a>
                <a href="/admin/marketing/send/{{ client.id }}" class="text-yellow-600A hover-underlineA blockA">Send Marketing</a>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="9" class="text-centerA py-6A text-gray-500A">No clients found.</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}
